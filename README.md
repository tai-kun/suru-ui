# suru-ui

Web 標準 API とステートマシン、React を活用した UI コンポーネントライブラリの実験的な実装。

[![Test](https://github.com/tai-kun/suru-ui/actions/workflows/test.yaml/badge.svg)](https://github.com/tai-kun/suru-ui/actions/workflows/test.yaml)
[![Release on NPM](https://github.com/tai-kun/suru-ui/actions/workflows/release.yaml/badge.svg)](https://github.com/tai-kun/suru-ui/actions/workflows/release.yaml)
[![Canary Release on NPM](https://github.com/tai-kun/suru-ui/actions/workflows/canary-release.yaml/badge.svg)](https://github.com/tai-kun/suru-ui/actions/workflows/canary-release.yaml)

[![npm version](https://img.shields.io/npm/v/suru-ui)](https://www.npmjs.com/package/suru-ui)
[![npm canary version](https://img.shields.io/npm/v/suru-ui/canary)](https://www.npmjs.com/package/suru-ui?activeTab=versions)

[![License: MIT](https://img.shields.io/badge/License-MIT-red.svg)](https://opensource.org/licenses/MIT)

## 感じていること・考えていること

### 課題の認識と取り巻く状況の変化

従来、HTML 要素で発生するあらゆるイベントは React のライフサイクルが管理し、API を通じて JavaScript で (ほぼ) 完全に制御されてきた。コードが状態を従い、目の前のコードがすべてであるという設計は、Web アプリケーションをコードで明白に理解できる一方で、不必要に複雑化してしまう問題を抱えている。開発者ツールを使わない限りは意図した動作を (後方互換性も含めて) 保証するための策と解釈することで納得できるが、Web にはすでに標準機能としてフォーム検証が存在し、今後は最上位レイヤーや Popover API、CSS Anchor Positioning など、JavaScript で表現・制御 (開閉やアクセシビリティ、フォーカストラップなど) してきた一部の機能も標準になろうとしている。

### React の鞘に収まりたい

React は極めて捨てがたいフレームワークだが、ちまちま useState したり、Context.Provider でちょっと楽なバケツリレー (宛先のない投げ渡し) をポリポリ書くのは面倒に感じてくることもある。捨てる・捨てないではなく取捨選択したい (が、現状多くの UI コンポーネントライブラリはフレームワークと強く結びつきすぎているし、[htmx](https://htmx.org/) のように振り切るのも悩ましい)。

このような経緯と個人的なお気持ちから、通常は見捨てられることのない後方互換性とともに広域なプラットフォームのサポートや JavaScript による完全な制御を諦め、ブラウザのイベントにある程度身を任せた UI コンポーネントを検討したい。つまりこれまで React で従えてきたすべてを部分的に React が従うようにする。

### ステートマシンによる制御

JavaScript による完全な制御を諦めることはすなわち標準 API の利用許可を得たということだが、その場合コンポーネントの props に絶対的な支配権は無く、こうあったらいいな程度の弱い意味しか持たない場面がでてくるため、ブラウザのイベントに身を任せつつ props の要求にも可能な限り対応するコストが重くなってくる。そこで props の変更もある種の cancelable なイベントとみなして標準 API のイベントとともにステートマシンによる状態遷移の定義へ落とし込み、制御できるか実験する。

ステートマシンは有名なところだと [Chakra UI](https://chakra-ui.com/) が提供する [Zag](https://zagjs.com/) で活用されている。Zag の場合は React 以外にも Vue や Solid といった異なるフレームワーク間の違いを吸収するのがステートマシンを使う動機になっているようだが、論理的に異なる文脈で発生するイベントに従う状態遷移の表現という意味では、今回のケースにもうまく当てはまってくれるだろうと考える。

ステートマシンのライブラリを探して `xstate@5.9.1` か `@zag-js/core@0.38.0` を検討したが、`createMachine` のみを利用した場合のバンドルサイズ (minified + gzipped) がそれぞれ [14 KB](https://shakerphobia.netlify.app/?imports=createMachine&pkg=xstate%405.9.1) と [5.5 KB](https://shakerphobia.netlify.app/?imports=createMachine&pkg=%40zag-js%2Fcore%400.38.0) で少し大きいと感じた。実際には React 用のライブラリも別途インストールする必要があるので、もっと大きくなることを考えると、React に特化してより軽量 (1 KB) な [`@cassiozen/usestatemachine`](https://github.com/cassiozen/useStateMachine) を採用したい。ただしこちらは最新リリースの 2022 年 1 月 15 日から 2 年以上も空いているので、メンテナンスされていないと判断。フォークしてリファクタリングして React の必須条件を 16.8 以降から 18 以降へ引き上げることでいくつかの新機能を追加し [`tai-kun/useStateMachine`](https://github.com/tai-kun/useStateMachine) ([npm](https://www.npmjs.com/package/@tai-kun/use-state-machine)) として公開する。全機能を ESM でバンドルした場合のサイズは 1.5 KB (minified + gzipped) 未満になったので、満足してこちらを使っていくことにする。

### さいごに

今回の実験を通して、ブラウザのイベントに身を任せた UI コンポーネント開発の可能性を探り、従来の React 開発と比較検討することで、より単純で効率的な開発方法を見つけたい。

## TODO

### 列

#### 優先順位

- `2`: 標準 API を積極的に活用するコンポーネント。
- `1`: 今回の実験とはあまり関係ないが、個人的な Web アプリを作る上で欠かせないと感じるコンポーネント。
- `0`: 余力があれば実装するコンポーネント。

#### 状況

- `3`: 実装完了。Story もテストも完了している。
- `2`: 実装のみほとんど完了しているが、Story やテストが未実装か不完全。
- `1`: 実装中。
- `0`: 未実装。

#### モバイル対応

- `2`: 対応。
- `1`: 必要性を認識しているが未対応。
- `0`: 未検討。

### `suru-ui/base`

| コンポーネント名           | 優先順位 | 状況 | モバイル対応 | 説明 |
| :--------------------- | :----: | :-: | :-------: | :-- |
| DialogBase             |  `2`   | `2` |    `0`    | ダイアログの基本的な実装とスタイルを提供します。モーダルダイアログやアラートダイアログなど、様々な種類のダイアログを作成するために使用できます。 |
| PopoverBase            |  `2`   | `2` |    `0`    | Popover API を利用したポップオーバーの基本的な実装とスタイルを提供します。ツールチップやメニューなど、様々な種類のポップオーバーを作成するために使用できます。 |
| ButtonBase             |  `1`   | `2` |    `1`    | ボタンの基本的な実装とスタイルを提供します。様々な種類のボタンを作成するために使用できます。 |
| HoverBase              |  `1`   | `0` |    `1`    | ホバーを検知するための基本的な実装とスタイルを提供します。ツールチップやメニューなど作成するために使用できます。 |

### `suru-ui/core`

| コンポーネント名           | 優先順位 | 状況 | モバイル対応 | 説明 |
| :--------------------- | :----: | :-: | :-------: | :-- |
| Accordion              |  `2`   | `0` |    `0`    | 複数のパネルを折りたたみ式で表示することができます。 |
| Alert                  |  `2`   | `0` |    `0`    | 画面端にアラートメッセージを表示するコンポーネントです。情報、警告、エラーなど、様々な種類のメッセージを表示することができます。 |
| AlertDialog            |  `2`   | `0` |    `0`    | モーダルダイアログとして表示されるコンポーネントです。重要なメッセージや確認メッセージを表示する際に使用されます。 |
| Dialog                 |  `2`   | `0` |    `0`    | ウィンドウにオーバーレイされるモーダルダイアログです。背後にあるコンテンツはすべて不活性化されます。 |
| Menu                   |  `2`   | `0` |    `0`    | リスト形式のドロップダウンメニューです。 |
| Popover                |  `2`   | `0` |    `0`    | トリガーの周囲に浮かぶ非モーダルダイアログです。ユーザーにコンテキスト情報を表示するために使用され、クリック可能なトリガー要素を組み合わせて使います。 |
| Select                 |  `2`   | `0` |    `0`    | ドロップダウンのリストコンポーネントです。リストの中から1つの項目を選択することができます。 |
| TextArea               |  `2`   | `0` |    `0`    | 複数行のテキストを入力できるコンポーネントです。 |
| TextField              |  `2`   | `0` |    `0`    | 1 行のテキストを入力できるコンポーネントです。 |
| Breadcrumbs            |  `1`   | `0` |    `0`    | パンくずリストです。現在のページの位置を視覚的に示すことができます。 |
| Button                 |  `1`   | `0` |    `0`    | 様々なスタイルのバリエーションを持つボタンです。クリックイベントなどを処理することができます。 |
| Checkbox               |  `1`   | `0` |    `0`    | チェックボックスコンです。オン/オフを切り替えることができます。 |
| Divider                |  `1`   | `0` |    `0`    | コンテンツを区切るための仕切り線です。 |
| Heading                |  `1`   | `0` |    `0`    | 見出しテキストを表示するコンポーネントです。H1 から H5 までのサイズを設定することができます。 |
| Icon                   |  `1`   | `0` |    `0`    | アイコンを表示するコンポーネントです。`suru-ui/icons` で提供されるアイコンの定義をレンダリングします。 |
| IconButton             |  `1`   | `0` |    `0`    | アイコン付きのボタンです。クリックイベントなどを処理することができます。 |
| InlineAlert            |  `1`   | `0` |    `0`    | インラインでアラートが表示されるコンポーネントです。短いメッセージを表示する際に使用されます。 |
| Label                  |  `1`   | `0` |    `0`    | テキストラベルを表示するコンポーネントです。フォーム入力欄などに使用されます。 |
| Link                   |  `1`   | `0` |    `0`    | リンクを作成するコンポーネントです。内部リンクや外部リンクを設定することができます。利便性のために不活性用の `disabled` 属性を持ちます。 |
| Loader                 |  `1`   | `0` |    `0`    | 読み込みアニメーションを表示するコンポーネントです。データ読み込み中などの待ち時間に表示されます。 |
| MenuList               |  `1`   | `0` |    `0`    | 階層化されたリストを表示するコンポーネントです。 |
| Pagination             |  `1`   | `0` |    `0`    | ページ送りの機能を提供するコンポーネントです。複数ページにわたるコンテンツを分割して表示することができます。 |
| Radio                  |  `1`   | `0` |    `0`    | ラジオボタンです。複数選択肢から1つを選択することができます。 |
| Suppl                  |  `1`   | `0` |    `0`    | 補足的な情報を表示するコンポーネントです。 |
| Text                   |  `1`   | `0` |    `0`    | テキストを表示するコンポーネントです。様々なスタイルを設定することができます。 |
| Drawer                 |  `0`   | `0` |    `0`    | 画面端に表示されるドロワーメニューコンポーネントです。ナビゲーションメニューなどに使用されます。 |
| ProgressBar            |  `0`   | `0` |    `0`    | ファイルのダウンロードや画像のアップロードなどのタスクの進行状況を線形に示すために使用できます。 |
| ProgressCircle         |  `0`   | `0` |    `0`    | ファイルのダウンロードや画像のアップロードなどのタスクの進行状況を円形に示すために使用できます。 |

### `suru-ui/lab`

| コンポーネント名           | 優先順位 | 状況 | モバイル対応 | 説明 |
| :--------------------- | :----: | :-: | :-------: | :-- |
| CloseButton            |  `1`   | `0` |    `0`    | 閉じるボタンを表示するコンポーネントです。ダイアログやポップオーバーなどを閉じる際に使用されます。 |
| NumberField            |  `1`   | `0` |    `0`    | 数値用の入力コンポーネントです。 |
| PasswordField          |  `1`   | `0` |    `0`    | パスワード用の入力コンポーネントです。 |
| SearchField            |  `1`   | `0` |    `0`    | 検索用の入力コンポーネントです。 |
| Skeleton               |  `1`   | `0` |    `0`    | コンテンツの読み込み中に表示されるプレースホルダーコンポーネントです。 |
| Switch                 |  `1`   | `0` |    `0`    | オン/オフを切り替えるスイッチコンポーネントです。 |
| TableGrid              |  `1`   | `0` |    `0`    | テーブル形式でグリッド表示するコンポーネントです。 |
| Tabs                   |  `1`   | `0` |    `0`    | タブ形式でコンテンツを切り替えるコンポーネントです。 |
| Toggle                 |  `1`   | `0` |    `0`    | オン/オフで表示するコンポーネントを切り替えるトグルコンポーネントです。 |
| Tooltip                |  `1`   | `0` |    `0`    | ツールチップを表示するコンポーネントです。ホバー時に説明文などを表示することができます。 |
| Avatar                 |  `0`   | `0` |    `0`    | プロフィール画像などを表示するアバターコンポーネントです。 |
| Badge                  |  `0`   | `0` |    `0`    | アイコンやテキストの上にバッジを表示するコンポーネントです。新着情報などを表示する際に使用されます。 |
| Clipboard              |  `0`   | `0` |    `0`    | テキストをクリップボードにコピーする機能を提供するコンポーネントです。 |
| ContextualHelp         |  `0`   | `0` |    `0`    | ポップオーバーなどを用いて、マウスホバーまたはタッチで操作方法や説明を表示することができます。 |
| DataTable              |  `0`   | `0` |    `0`    | データをテーブル形式を表示するコンポーネントです。ソートやフィルタリングなどの機能を備えています。 |
| DateField              |  `0`   | `0` |    `0`    | 日付用の入力コンポーネントです。 |
| InlineBadge            |  `0`   | `0` |    `0`    | インラインで表示されるバッジコンポーネントです。 |
| Keyboard               |  `0`   | `0` |    `0`    | ショートカットキーなどのキーボード操作を受け付けることを表すコンポーネントです。 |
| Menubar                |  `0`   | `0` |    `0`    | 複数の連続に並んだ `Menu` コンポーネントをまとめて表示するコンポーネントです。 |
| Meter                  |  `0`   | `0` |    `0`    | メーターゲージを表示するコンポーネントです。 |
| RangeSlider            |  `0`   | `0` |    `0`    | 範囲を指定するためのスライダーコンポーネントです。 |
| Slider                 |  `0`   | `0` |    `0`    | 数値を指定するためのスライダーコンポーネントです。 |
| Tag                    |  `0`   | `0` |    `0`    | タグを表示するコンポーネントです。ラベルや分類などに使用されます。 |
| TimeField              |  `0`   | `0` |    `0`    | 時刻用の入力コンポーネントです。 |
| TreeView               |  `0`   | `0` |    `0`    | ツリービューを表示するコンポーネントです。階層構造のデータを可視化することができます。 |
